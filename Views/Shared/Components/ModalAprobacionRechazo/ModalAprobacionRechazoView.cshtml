<head>
  <link rel="stylesheet" href="~/css/Components/ModalAprobacionRechazoView.css" />
</head>

<dialog open class="modal" id="modal">
  <div class="modal-container">
    <div class="content">
      <div class="btn-cerrar">
        <button class="btn btn-cerrar" id="btn-cerrar"><i class="fi fi-tr-x"></i></button>
      </div>
      <div class="header">
        <div class="icono">
          @{
            if (ViewBag.Tipo == "aprobacion")
            {
              <i class="fi fi-tr-memo-circle-check" style="color:var(--accent-color)"></i>
            }
            else if (ViewBag.Tipo == "rechazo")
            {
              <i class="fi fi-tr-vote-nay" style="color:red;"></i>
            }
          }
        </div>
        <div class="titulo">
          <h2>@ViewBag.Titulo</h2>
        </div>
      </div>
      <div class="formContainer">
        @{
          if (ViewBag.Tipo == "rechazo")
          {
            <form id="frmRechazo" asp-action="RechazarSolicitudPrestamo" asp-controller="Prestamos" method="post">
              <div class="campos">
                <div class="campo" id="campo" style="display: none;">
                  <label for="@ViewBag.Parametro">@ViewBag.Parametro</label>
                  <input type="text" name="@ViewBag.Parametro" id="@ViewBag.Parametro" value="@((ViewBag.id) ?? "")">
                </div>
                <div class="campo" id="campo_nota">
                  <label for="nota_aprobacion_rechazo">Razon de rechazo:</label>
                  <textarea name="notaRechazo" id="nota_aprobacion_rechazo"></textarea>
                </div>
                <div class="buttons">
                  <button type="submit" class="btn btn-submit btnRechazar" id="btn-aprobacionrechazo">Rechazar</button>
                  <button class="btn btn-cancelar" id="btn-cancelar">Cancelar</button>
                </div>
              </div>
            </form>
          }
          else
          {
            <form id="frmAprobacion" asp-action="AprobarSolicitudPrestamo" asp-controller="@ViewBag.Controlador"
              method="post">
              <div class="campos">
                <div class="campo" id="campo" style="display: none;">
                  <label for="@ViewBag.Parametro">@ViewBag.Parametro</label>
                  <input type="text" name="@ViewBag.Parametro" id="@ViewBag.Parametro" value="@((ViewBag.id) ?? "")">
                </div>
                <div class="campo" id="campo_solicitado">
                  <label for="monto_solicitado">Monto solicitado:</label>
                  <input type="text" name="montoSolicitado" id="monto_solicitado" value="@((ViewBag.montoSolicitado) ?? "")"
                    disabled>
                </div>
                <div class="campo" id="campo_monto_aprobado">
                  <label for="monto_aprobado">Monto a aprobar</label>
                  <input type="text" name="montoAprobado" id="monto_aprobado">
                </div>
                <div class="campo" id="campo_nota">
                  <label for="nota_aprobacion_rechazo">Nota de Aprobación</label>
                  <textarea name="notaAprobacion" id="nota_aprobacion_rechazo"></textarea>
                </div>
                <div class="buttons">
                  <button type="submit" class="btn btn-submit btn-aprobar" id="btn-aprobacionrechazo">Aprobar</button>
                  <button class="btn btn-cancelar" id="btn-cancelar">Cancelar</button>
                </div>
              </div>
            </form>
          }
        }
      </div>
    </div>
  </div>
</dialog>

<script>

  const dialog = document.querySelector("dialog");

  if (dialog != null) {

    const btnCerrar = document.getElementById("btn-cerrar");
    btnCerrar.addEventListener("click", (e) => {
      e.preventDefault();
      dialog.close();
    });

    const btnCancelar = document.getElementById("btn-cancelar");
    btnCancelar.addEventListener("click", (e) => {
      e.preventDefault();
      dialog.close();
    });

  }

  const frmAprobacion = document.getElementById("frmAprobacion");
  const frmRechazo = document.getElementById("frmRechazo");
  const inputMontoSolicitado = document.getElementById("monto_solicitado");
  const inputMontoAprobado = document.getElementById("monto_aprobado");
  const textareaNotaAprobacion = document.getElementById("nota_aprobacion_rechazo");
  const submitBtn = document.getElementById("btn-aprobacionrechazo").disabled = true;


  if (frmAprobacion != null) {
    inputMontoAprobado.addEventListener("change", (e) => {

      let montoSolicitado = inputMontoSolicitado.value;
      let montoAprobado = inputMontoAprobado.value;

      const error = document.getElementById("error_monto_aprobado");
      const errorNotaAprobacion = document.getElementById("error_nota_aprobacion");


      if (error != null) {
        error.remove();
      }

      if (errorNotaAprobacion != null) {
        errorNotaAprobacion.remove();
      }

      if (Number(montoAprobado) > Number(montoSolicitado)) {

        inputMontoAprobado.style.outline = "1px solid red";
        const error = document.createElement("p");
        error.id = "error_monto_aprobado";
        error.style.color = "red";
        error.style.fontSize = "12px";
        error.style.margin = "0px";
        error.style.padding = "0px";
        error.textContent = "El monto aprobado no puede ser mayor al monto solicitado";
        inputMontoAprobado.after(error);
        const submitBtn = document.getElementById("btn-aprobacionrechazo").disabled = true;


      } else if (Number(montoAprobado) < Number(montoSolicitado) && textareaNotaAprobacion.value == "") {

        inputMontoAprobado.style.outline = "none";
        textareaNotaAprobacion.style.outline = "1px solid red";
        const error = document.createElement("p");
        error.id = "error_nota_aprobacion";
        error.style.color = "red";
        error.style.fontSize = "12px";
        error.style.margin = "0px";
        error.style.padding = "10px 0px";
        error.textContent = "La nota de aprobación es requerida cuando el monto aprobado es menor al monto solicitado";
        textareaNotaAprobacion.after(error);
        const submitBtn = document.getElementById("btn-aprobacionrechazo").disabled = true;

      } else {
        inputMontoAprobado.style.outline = "none";
        textareaNotaAprobacion.style.outline = "none";
        const submitBtn = document.getElementById("btn-aprobacionrechazo").disabled = false;
      }

    })

    textareaNotaAprobacion.addEventListener("change", (e) => {
      let montoSolicitado = inputMontoSolicitado.value;
      let montoAprobado = inputMontoAprobado.value;

      const error = document.getElementById("error_nota_aprobacion");

      if (error != null) {
        error.remove();
      }

      if ((Number(montoAprobado) < Number(montoSolicitado)) && textareaNotaAprobacion.value == "") {

        textareaNotaAprobacion.style.outline = "1px solid red";
        const error = document.createElement("p");
        error.id = "error_nota_aprobacion";
        error.style.color = "red";
        error.style.fontSize = "12px";
        error.style.margin = "0px";
        error.style.padding = "0px";
        error.textContent = "La nota de aprobación es requerida cuando el monto aprobado es menor al monto solicitado";
        textareaNotaAprobacion.after(error);
        const submitBtn = document.getElementById("btn-aprobacionrechazo").disabled = true;

      } else {

        inputMontoAprobado.style.outline = "none";
        textareaNotaAprobacion.style.outline = "none";
        const submitBtn = document.getElementById("btn-aprobacionrechazo").disabled = false;

      }
    });

  }


  if (frmRechazo != null) {
    textareaNotaAprobacion.addEventListener("change", (e) => {
      const error = document.getElementById("error_nota_aprobacion");

      if (error != null) {
        error.remove();
      }

      if (textareaNotaAprobacion.value == "") {
        textareaNotaAprobacion.style.outline = "1px solid red";
        const error = document.createElement("p");
        error.id = "error_nota_aprobacion";
        error.style.color = "red";
        error.style.fontSize = "12px";
        error.style.margin = "0px";
        error.style.padding = "0px";
        error.textContent = "La nota de rechazo es requerida";
        textareaNotaAprobacion.after(error);
        const submitBtn = document.getElementById("btn-aprobacionrechazo").disabled = true;
      } else {
        textareaNotaAprobacion.style.outline = "none";
        const submitBtn = document.getElementById("btn-aprobacionrechazo").disabled = false;
      }
    });
  }

</script>